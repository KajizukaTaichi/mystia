<!doctype html>
<html>
    <head>
        <title>
            Mystia | A programming language that will be compiled to WebAssembly
        </title>
        <meta charset="utf-8" />
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bulma@1.0.2/css/bulma.min.css"
        />
        <style>
            body {
                font-size: larger;
            }
            #code {
                font-family: monospace;
                height: 10rlh;
                resize: none;
            }
        </style>
    </head>
    <body class="content">
        <section class="hero">
            <div class="hero-body">
                <h1 class="title">Mystia</h1>
                <p class="block">
                    A programming language that will be compiled to WebAssembly
                </p>
                <h4>Features</h4>
                <ol>
                    <li>
                        Type inference: You can use variable without having
                        declare and annotation
                    </li>
                    <li>
                        ML-like syntax: The syntax is inspired by ML-family
                        language (e.g. define function using let statement)
                    </li>
                </ol>
            </div>
        </section>
        <hr />
        <section class="section">
            <h4>Playground</h4>
            <div class="field">
                <div class="control">
                    <textarea id="code" class="textarea"></textarea>
                </div>
            </div>
            <div class="field is-grouped">
                <div class="control">
                    <button id="run" type="button" class="button">Run</button>
                </div>
            </div>
            <div class="field">
                <label class="label" for="result">Resultï¼š</label>
                <p id="result" class="alert"></p>
            </div>
        </section>
        <script type="module">
            import { mystia } from "./main.js";

            let codeEditor = document.getElementById("code");
            let resultArea = document.getElementById("result");
            let runBtn = document.getElementById("run");

            codeEditor.value = `let is_prime(n: int) = {
    let i = 2;
    if n < i then {
        return false
    };
    while i * i <= n loop {
        if n % i == 0 then {
            return false
        };
        let i = i + 1
    };
    true
};

if is_prime(5987)
    then "just a prime number"
    else "not a prime number"
`;

            runBtn.addEventListener("click", async (e) => {
                try {
                    let result = await mystia(codeEditor.value);
                    if (result !== undefined) {
                        let string = result.getString();
                        if (string !== "") {
                            resultArea.innerHTML = `"${string}"`;
                        } else {
                            resultArea.innerHTML = result.getValue();
                        }
                    }
                } catch (e) {
                    console.error(e);
                }
            });
        </script>
    </body>
</html>
