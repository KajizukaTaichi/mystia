<!doctype html>
<html>
    <head>
        <title>
            Mystia | Let's try out Mystia, a programming language that will be
            compiled to WebAssembly on your browser
        </title>
        <meta charset="utf-8" />
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bulma@1.0.2/css/bulma.min.css"
        />
        <style>
            body {
                height: 100vh;
            }
            .inline-elements {
                gap: 10px;
                display: flex;
                align-items: center;
                margin-bottom: 10px;
                align-items: center;
            }
            #example-guide {
                white-space: nowrap;
            }
            #code {
                font-family: "Courier New", Courier, monospace;
                height: 15rlh;
                resize: vertical;
            }
            #result {
                font-size: larger;
                font-family: monospace;
            }
        </style>
    </head>
    <body class="content">
        <section class="hero">
            <div class="hero-body content">
                <h1 class="title">Mystia Playground</h1>
                <p class="block">
                    Let's try out Mystia, a programming language that will be
                    compiled to WebAssembly on your browser
                </p>
                <a href="https://github.com/KajizukaTaichi/mystia">
                    Repository
                </a>
                <p>&COPY; 2025 梶塚太智. All rights reserved</p>
                <hr />

                <div class="inline-elements">
                    <button id="run" type="button" class="button">Run</button>
                    <button id="build" type="button" class="button">Run</button>
                    <a
                        class="button"
                        href="https://github.com/KajizukaTaichi/mystia/tree/master/example"
                    >
                        Example code:
                    </a>
                    <input id="example-field" class="input" value="prime" />
                    <button id="example-select" type="button" class="button">
                        Select
                    </button>
                </div>
                <textarea
                    id="code"
                    class="textarea"
                    placeholder="Your code is here..."
                ></textarea>
                <br />
                <div class="field">
                    <label class="label" for="result">Result: </label>
                    <p id="result" class="alert"></p>
                    <label id="timer"></label>
                </div>
            </div>
        </section>

        <script type="module">
            import { mystia } from "./binding/web.mjs";
            let timer;

            const codeEditor = document.getElementById("code");
            const resultArea = document.getElementById("result");
            const runBtn = document.getElementById("run");
            const buildBtn = document.getElementById("build");

            const timerLabel = document.getElementById("timer");
            const exampleFieldInput = document.getElementById("example-field");
            const exampleSelectBtn = document.getElementById("example-select");

            exampleSelectBtn.addEventListener("click", () => {
                const exampleCodeUrl = `https://raw.githubusercontent.com/KajizukaTaichi/mystia/refs/heads/master/example/${exampleFieldInput.value}.ms`;
                fetch(exampleCodeUrl)
                    .then((response) => response.text())
                    .then((data) => (codeEditor.value = data));
            });

            runBtn.addEventListener("click", async (e) => {
                const startTime = Date.now();
                timer = setInterval(() => {
                    timerLabel.textContent = `Time: ${Date.now() - startTime}ms`;
                }, 1);
                try {
                    const result = await mystia(codeEditor.value);
                    resultArea.innerHTML = JSON.stringify(result, null, 2);
                } catch (error) {
                    resultArea.innerHTML = error;
                }
                clearInterval(timer);
            });

            buildBtn.addEventListener("click", () => {
                let newTab = window.open();
                let scr = newTab.document.createElement("script");
                scr.setAttribute("type", "module");
                scr.textContent = `import { mystia } from "https://kajizukataichi.github.io/mystia/binding/web.mjs"; mystia(\`${codeEditor.value}\`)`;
                newTab.document.body.appendChild(scr);
            });
        </script>
    </body>
</html>
